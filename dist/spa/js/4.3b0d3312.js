(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[4],{"00d3":function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticStyle:{"min-height":"inherit"}},[n("div",{ref:"blockly",staticClass:"blockly-wrap"}),n("xml",{ref:"toolbox",staticStyle:{display:"none"}},[t._t("default")],2)],1)},r=[],s=(n("ddb0"),n("ded3")),i=n.n(s),o=n("54ca"),l=n.n(o),c=n("2f62"),d="/**\r\n * IMPORTANT NOTE\r\n * This project MUST be ES5 compliant as that is what the JS Interpreter uses\r\n */\r\n\r\n/**\r\n * Simple tests\r\n */\r\nhasNumber = /\\d/\r\n \r\n/**\r\n * Stores events being listened to\r\n * {eventName: [...callbacks]}\r\n */\r\n_events = {}\r\n\r\n/**\r\n * console.log helper to properly send data to main app w/o obfuscation\r\n */\r\nconsole = {\r\n  log: function (arguments) {\r\n    log(JSON.stringify(arguments))\r\n  }\r\n}\r\n\r\n/**\r\n * target.addEventListener subsitution\r\n * @param {String} eventName The eventName to store this callback under\r\n * @param {Array} args The list of arguments\r\n * @param {Function} callback The function to call when this event is triggered\r\n */\r\naddEventListener = function (eventName, args, callback) {\r\n  if (!_events[eventName]) {\r\n    _events[eventName] = []\r\n  }\r\n\r\n  _events[eventName].push({\r\n    args: args,\r\n    callback: callback\r\n  })\r\n}\r\n\r\n/**\r\n * Trigger an event\r\n * @param {String} eventName \r\n * @param {*} payload\r\n */\r\ntriggerEvent = function (eventName, payload) {\r\n  _events[eventName] && _events[eventName].forEach(function (event) {\r\n    event.callback({\r\n      args: event.args,\r\n      payload: JSON.parse(payload)\r\n    })\r\n  })\r\n}\r\n\r\n/**\r\n * Plays a note\r\n */\r\nplayNote = function (payload) {\r\n  _playNote(JSON.stringify(payload))\r\n}\r\n\r\n/**\r\n * Compre helper for working with \"is\", \"is not\", etc\r\n */\r\ncompare = function (a, compare, b) {\r\n  switch (compare) {\r\n    case 'is':\r\n      return a == b\r\n    case 'is not':\r\n      return a != b\r\n  }\r\n}\r\n\r\n/**\r\n * Checks if a string belongs to the \"is any\" family (\"all\", \"any\", etc)\r\n */\r\nisAny = function (str) {\r\n  var list = ['any', 'all']\r\n  var isValid = false\r\n\r\n  list.forEach(function (item) {\r\n    if (str === item) isValid = true\r\n  });\r\n\r\n  return isValid\r\n}\r\n\r\n/**\r\n * Checks if a given note matches a webmidi.name\r\n * - If no octave present, then matches the key in any octave\r\n */\r\nisNote = function (a, compare, b) {\r\n  switch (compare) {\r\n    case 'is':\r\n      if (hasNumber.test()) {\r\n        return a == b.name.concat(b.octave)\r\n      } else {\r\n        return a == b.name\r\n      }\r\n\r\n    case 'is not':\r\n      if (hasNumber.test()) {\r\n        return a != b.name.concat(b.octave)\r\n      } else {\r\n        return a != b.name\r\n      }\r\n  }\r\n}",p=n("c62b"),m=n.n(p),u={name:"Blockly",props:["options"],watch:{"workspace.code"(t){this.$store.commit("set",["workspace.interpreter",new window.Interpreter(d+"\n"+this.workspace.code,this.setupInterpreter)]),this.workspace.interpreter.run()}},computed:i()({},Object(c["b"])(["workspace","devices"])),data(){return{blockly:null,interpreter:null}},mounted(){let t=this.$props.options||{};t.toolbox||(t.toolbox=this.$refs.toolbox),this.blockly=l.a.inject(this.$refs.blockly,t),this.blockly.addChangeListener(this.onChange)},methods:{onChange(t){switch(t.type){case l.a.Events.BLOCK_CREATE:case l.a.Events.BLOCK_DELETE:case l.a.Events.BLOCK_CHANGE:case l.a.Events.BLOCK_MOVE:case l.a.Events.VAR_CREATE:case l.a.Events.VAR_DELETE:case l.a.Events.VAR_RENAME:this.$store.commit("set",["workspace.code",l.a.JavaScript.workspaceToCode(this.blockly)]);break}},setupInterpreter(t,e){t.setProperty(e,"log",t.createNativeFunction(t=>{console.log("ðŸ“¦ log: ",...JSON.parse(t))})),t.setProperty(e,"_playNote",t.createNativeFunction(t=>{let e=JSON.parse(t);"all"===e.device&&Object.keys(this.devices.outputs).forEach(t=>{const n=m.a.getOutputById(t);n.playNote(e.note,e.channel)})}))}}},h=u,v=n("2877"),g=Object(v["a"])(h,a,r,!1,null,null,null);e["a"]=g.exports},cf36:function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("q-page",{staticClass:"full-height"},[n("Workspace",{ref:"blockly",staticClass:"blockly",attrs:{options:t.options}},[n("category",{attrs:{name:"MIDI Events",colour:"#9fa55b"}},[n("block",{attrs:{type:"midi_on_event"}})],1),n("category",{attrs:{name:"MIDI Arguments",colour:"#a5935b"}},[n("block",{attrs:{type:"midi_arg_compare_note"}})],1),n("category",{staticClass:"block-category-send-midi",attrs:{name:"Send MIDI",colour:"#5ba5a5"}},[n("block",{attrs:{type:"midi_send_note"}})],1),n("sep"),n("category",{attrs:{name:"Logic",colour:"#5b80a5"}},[n("block",{attrs:{type:"controls_if"}}),n("block",{attrs:{type:"logic_compare"}},[n("field",{attrs:{name:"OP"}},[t._v("EQ")])],1),n("block",{attrs:{type:"logic_operation"}},[n("field",{attrs:{name:"OP"}},[t._v("AND")])],1),n("block",{attrs:{type:"logic_negate"}}),n("block",{attrs:{type:"logic_boolean"}},[n("field",{attrs:{name:"BOOL"}},[t._v("TRUE")])],1),n("block",{attrs:{type:"logic_null"}}),n("block",{attrs:{type:"logic_ternary"}})],1),n("category",{attrs:{name:"Loops",colour:"#5ba55b"}},[n("block",{attrs:{type:"controls_repeat_ext"}},[n("value",{attrs:{name:"TIMES"}},[n("shadow",{attrs:{type:"math_number"}},[n("field",{attrs:{name:"NUM"}},[t._v("10")])],1)])],1),n("block",{attrs:{type:"controls_whileUntil"}},[n("field",{attrs:{name:"MODE"}},[t._v("WHILE")])],1),n("block",{attrs:{type:"controls_for"}},[n("field",{attrs:{name:"VAR",id:"+x@[E{uUuMC(G!%lB~vF"}},[t._v("i")]),n("value",{attrs:{name:"FROM"}},[n("shadow",{attrs:{type:"math_number"}},[n("field",{attrs:{name:"NUM"}},[t._v("1")])],1)]),n("value",{attrs:{name:"TO"}},[n("shadow",{attrs:{type:"math_number"}},[n("field",{attrs:{name:"NUM"}},[t._v("10")])],1)]),n("value",{attrs:{name:"BY"}},[n("shadow",{attrs:{type:"math_number"}},[n("field",{attrs:{name:"NUM"}},[t._v("1")])],1)])],1),n("block",{attrs:{type:"controls_forEach"}},[n("field",{attrs:{name:"VAR",id:"E`D{pL/f#h?~8#[VL5rC"}},[t._v("j")])],1),n("block",{attrs:{type:"controls_flow_statements"}},[n("field",{attrs:{name:"FLOW"}},[t._v("BREAK")])],1)],1),n("category",{attrs:{name:"Math",colour:"#5b67a5"}},[n("block",{attrs:{type:"math_number"}},[n("field",{attrs:{name:"NUM"}},[t._v("0")])],1),n("block",{attrs:{type:"math_arithmetic"}},[n("field",{attrs:{name:"OP"}},[t._v("ADD")]),n("value",{attrs:{name:"A"}},[n("shadow",{attrs:{type:"math_number"}},[n("field",{attrs:{name:"NUM"}},[t._v("1")])],1)]),n("value",{attrs:{name:"B"}},[n("shadow",{attrs:{type:"math_number"}},[n("field",{attrs:{name:"NUM"}},[t._v("1")])],1)])],1),n("block",{attrs:{type:"math_single"}},[n("field",{attrs:{name:"OP"}},[t._v("ROOT")]),n("value",{attrs:{name:"NUM"}},[n("shadow",{attrs:{type:"math_number"}},[n("field",{attrs:{name:"NUM"}},[t._v("9")])],1)])],1),n("block",{attrs:{type:"math_trig"}},[n("field",{attrs:{name:"OP"}},[t._v("SIN")]),n("value",{attrs:{name:"NUM"}},[n("shadow",{attrs:{type:"math_number"}},[n("field",{attrs:{name:"NUM"}},[t._v("45")])],1)])],1),n("block",{attrs:{type:"math_constant"}},[n("field",{attrs:{name:"CONSTANT"}},[t._v("PI")])],1),n("block",{attrs:{type:"math_number_property"}},[n("mutation",{attrs:{divisor_input:"false"}}),n("field",{attrs:{name:"PROPERTY"}},[t._v("EVEN")]),n("value",{attrs:{name:"NUMBER_TO_CHECK"}},[n("shadow",{attrs:{type:"math_number"}},[n("field",{attrs:{name:"NUM"}},[t._v("0")])],1)])],1),n("block",{attrs:{type:"math_round"}},[n("field",{attrs:{name:"OP"}},[t._v("ROUND")]),n("value",{attrs:{name:"NUM"}},[n("shadow",{attrs:{type:"math_number"}},[n("field",{attrs:{name:"NUM"}},[t._v("3.1")])],1)])],1),n("block",{attrs:{type:"math_on_list"}},[n("mutation",{attrs:{op:"SUM"}}),n("field",{attrs:{name:"OP"}},[t._v("SUM")])],1),n("block",{attrs:{type:"math_modulo"}},[n("value",{attrs:{name:"DIVIDEND"}},[n("shadow",{attrs:{type:"math_number"}},[n("field",{attrs:{name:"NUM"}},[t._v("64")])],1)]),n("value",{attrs:{name:"DIVISOR"}},[n("shadow",{attrs:{type:"math_number"}},[n("field",{attrs:{name:"NUM"}},[t._v("10")])],1)])],1),n("block",{attrs:{type:"math_constrain"}},[n("value",{attrs:{name:"VALUE"}},[n("shadow",{attrs:{type:"math_number"}},[n("field",{attrs:{name:"NUM"}},[t._v("50")])],1)]),n("value",{attrs:{name:"LOW"}},[n("shadow",{attrs:{type:"math_number"}},[n("field",{attrs:{name:"NUM"}},[t._v("1")])],1)]),n("value",{attrs:{name:"HIGH"}},[n("shadow",{attrs:{type:"math_number"}},[n("field",{attrs:{name:"NUM"}},[t._v("100")])],1)])],1),n("block",{attrs:{type:"math_random_int"}},[n("value",{attrs:{name:"FROM"}},[n("shadow",{attrs:{type:"math_number"}},[n("field",{attrs:{name:"NUM"}},[t._v("1")])],1)]),n("value",{attrs:{name:"TO"}},[n("shadow",{attrs:{type:"math_number"}},[n("field",{attrs:{name:"NUM"}},[t._v("100")])],1)])],1),n("block",{attrs:{type:"math_random_float"}})],1),n("sep"),n("category",{attrs:{name:"Variables",colour:"#a55b80",custom:"VARIABLE"}}),n("category",{attrs:{name:"Functions",colour:"#995ba5",custom:"PROCEDURE"}})],1)],1)},r=[],s=n("ded3"),i=n.n(s),o=n("2f62"),l=n("2ef0"),c=n("00d3"),d=n("8ded"),p=n.n(d),m=n("b7fd");m["JavaScript"]["midi_on_event"]=function(t){const e=t.getFieldValue("event"),n=t.getFieldValue("device"),a=m["JavaScript"].valueToCode(t,"args",m["JavaScript"].ORDER_ATOMIC),r=m["JavaScript"].statementToCode(t,"statements");let s=`addEventListener('${e}', [{\n  type: 'midi_arg_compare_device',\n  condition: 'is',\n  device: '${n}'\n}, ${a}], function (event) {\n  var data = event.payload;\n  var args = event.args;\n\n  console.log('event', event);\n  \n  // Exit if midi_args fail\n  var isValid = true;\n  event.args.forEach(function (arg) {\n    switch (arg.type) {\n      case 'midi_arg_compare_device':\n        if (!isAny(arg.device) && !compare(arg.device, arg.condition, data.target.id)) isValid = false;\n      break;\n      case 'midi_arg_compare_note':\n        if (!isAny(arg.note) && !isNote(arg.note, arg.condition, data.note)) isValid = false;\n      break;\n    }\n  });\n  if (!isValid) return;\n  \n${r}\n});\n`;return s},m["Blocks"]["midi_on_event"]={init:function(){this.appendValueInput("args").setCheck("midi_arg").appendField("On MIDI").appendField(new m["FieldDropdown"]([["Note On","noteon"],["Note Off","noteoff"],["Control Change","controlchange"]]),"event").appendField("from device").appendField(new m["FieldTextInput"]("any"),"device"),this.appendStatementInput("statements").setCheck(null),this.setInputsInline(!1),this.setColour(60),this.setTooltip("Runs the midiblock when the selected MIDI event is triggered from the specified device. Attach MIDI Args to the right to fine-tune the event"),this.setHelpUrl("https://midiblocks.com/block/midi_on_event")}},m["JavaScript"]["midi_arg_compare_note"]=function(t){var e=t.getFieldValue("condition"),n=t.getFieldValue("note"),a=m["JavaScript"].valueToCode(t,"args",m["JavaScript"].ORDER_ATOMIC),r=`{\n  type: 'midi_arg_compare_note',\n  condition: '${e}',\n  note: '${n}'\n}`;return a&&(r+=", "+a),[r,m["JavaScript"].ORDER_ATOMIC]},m["Blocks"]["midi_arg_compare_note"]={init:function(){this.appendValueInput("args").setCheck("midi_arg").appendField("when note").appendField(new m["FieldDropdown"]([["is","is"],["is not","is not"]]),"condition").appendField(new m["FieldTextInput"]("any"),"note"),this.setOutput(!0,"midi_arg"),this.setColour(45),this.setTooltip("Compares the MIDI note"),this.setHelpUrl("https://midiblocks.com/block/midi_arg_compare_note")}},m["JavaScript"]["midi_send_note"]=function(t){let e=t.getFieldValue("note"),n=t.getFieldValue("device"),a=t.getFieldValue("channel"),r=`playNote({\n  event: typeof event !== 'undefined' ? event : null,\n  note: '${e}',\n  channel: '${a}',\n  device: '${n}'\n});\n`;return r},m["Blocks"]["midi_send_note"]={init:function(){this.appendDummyInput().appendField("Play note").appendField(new m["FieldTextInput"]("C4"),"note").appendField("on device").appendField(new m["FieldTextInput"]("all"),"device").appendField("on channel").appendField(new m["FieldTextInput"]("all"),"channel"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(180),this.setTooltip(""),this.setHelpUrl("")}};var u=n("3d20"),h=n.n(u),v=function(t){return t};m["prompt"]=function(t,e,n){h.a.fire({title:"Variable:",input:"text",inputAttributes:{autocapitalize:"off"},showCancelButton:!0,confirmButtonText:"Look up",showLoaderOnConfirm:!0,allowOutsideClick:()=>!h.a.isLoading()}).then(t=>{t.value&&n(v(t.value))})};var g=n("c62b"),_=n.n(g),b=n("8e6f"),f=n("614c");window.Interpreter=f["Interpreter"],window.acorn=b;const y=200;var k={name:"MainLayout",computed:i()({},Object(o["b"])(["workspace"])),components:{Workspace:c["a"]},mounted(){_.a.enable(t=>{const e={},n={};this.errors.webmidi.enable=t,_.a.inputs.forEach(t=>{e[t.id]=t,t.led=!1,t.lastMessage="",this.bindInput(t.id)}),_.a.outputs.forEach(t=>{n[t.id]=t}),this.$store.commit("set",["devices",{inputs:e,outputs:n}]),this.$root.$on("interpreter.triggerEvent",this.triggerEvent)})},watch:{splitter:Object(l["throttle"])((function(){p.a.set("splitter",this.splitter),setTimeout(()=>{window.dispatchEvent(new Event("resize"))})}),50,{leading:!0,trailing:!0}),isHoriz:Object(l["throttle"])((function(){p.a.set("isHoriz",this.isHoriz),setTimeout(()=>{window.dispatchEvent(new Event("resize"))})}),50,{leading:!0,trailing:!0})},data(){return{errors:{webmidi:{enable:!1}},isHoriz:p.a.get("isHoriz"),options:{media:"media/",zoom:{controls:!0,pinch:!0,wheel:!0},grid:{spacing:25,length:10,opacity:0,colour:"#efefef",snap:!0}},splitter:p.a.get("splitter")||window.innerWidth/3}},methods:{toggleHoriz(){this.isHoriz?this.splitter=window.innerWidth/3:this.splitter=y,this.isHoriz=!this.isHoriz},bindInput(t){const e=_.a.getInputById(t),n=["activesensing","channelaftertouch","channelmode","clock","continue","controlchange","keyaftertouch","noteoff","noteon","nrpn","pitchbend","programchange","reset","songposition","songselect","start","stop","sysex","timecode","tuningrequest","unknownsystemmessage"];n.forEach(t=>{e.addListener(t,"all",e=>{this.$root.$emit("interpreter.triggerEvent",t,e)})}),e.addListener("midimessage","all",t=>{this.$store.commit("set",[`devices.inputs['${t.target.id}'].led`,!0]),setTimeout(()=>{this.$store.commit("set",[`devices.inputs['${t.target.id}'].led`,!1])},10)})},triggerEvent(t,e){if(this.workspace.code){let n=Object.assign({},e);n.target=Object.assign({},n.target),delete n.target._midiInput,delete n.target._userHandlers,delete n.target.lastMessage,n=JSON.stringify(n),this.workspace.interpreter.appendCode(`triggerEvent('${t}', '${n}')`),this.workspace.interpreter.run()}let n;switch(t){case"noteon":case"noteoff":n=`[${e.note.number}, ${e.note.name}, ${e.note.octave}]`;break;case"controlchange":n=`[${e.controller.number}, ${e.controller.name}]`;break}this.$store.commit("set",[`devices.inputs['${e.target.id}'].lastMessage`,`<div>\n          <strong>${t}</strong>:\n          <span>${n}</span>\n        </div>\n        <div>\n          <strong>data</strong>:\n          <span>[${e.data[0]}, ${e.data[1]}, ${e.data[2]}]</span>\n        </div>`])}}},w=k,E=n("2877"),N=n("9989"),O=n("eebe"),I=n.n(O),M=Object(E["a"])(w,a,r,!1,null,null,null);e["default"]=M.exports;I()(M,"components",{QPage:N["a"]})}}]);